#!/bin/bash -e

function log() {
	echo 1>&2 "${@}"
}

function abort() {
	log "${@}"
	log 'Aborting.'
	exit 1
}

function success() {
	log "${@}"
	exit 0
}


if [ "$1" = 'setup' ]
then
	shift
	git config --local sync.fork.upstream.remote "$1"
	git config --local sync.fork.remote "$2"
	success "Successfully set the upstream remote ('$1') and the fork remote ('$2')."
fi

SOURCE_REMOTE=$(git config --local sync.fork.upstream.remote)
TARGET_REMOTE=$(git config --local sync.fork.remote)

[ -n "$SOURCE_REMOTE" -a -n "$TARGET_REMOTE" ] || abort "Use 'git fork-sync setup <upstream-remote> <fork-remote>' to set the remote to push to first."

git remote-sync "$SOURCE_REMOTE" "$TARGET_REMOTE"
